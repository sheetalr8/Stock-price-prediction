# -*- coding: utf-8 -*-
"""app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1oKl83KSgcIhpv3dUGrnx5X2xVc3HAGPX
"""

import streamlit as st
import yfinance as yf
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sklearn.linear_model import LogisticRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score

st.set_page_config(page_title="Stock Direction Predictor", layout="centered")

st.title("ðŸ“ˆ Real-Time Stock Direction Predictor")
st.write("Predict whether stock price will go UP or DOWN tomorrow")

# User input
stock_symbol = st.text_input("Enter Stock Symbol (e.g., AAPL, TSLA, INFY.NS)", "AAPL")

if st.button("Predict"):

    # Download stock data
    data = yf.download(stock_symbol, period="2y")

    if data.empty:
        st.error("Invalid stock symbol. Try again.")
    else:
        # Feature Engineering
        data["Return"] = data["Close"].pct_change()
        data["MA10"] = data["Close"].rolling(10).mean()
        data["MA50"] = data["Close"].rolling(50).mean()
        data["Volatility"] = data["Return"].rolling(10).std()

        # Target variable
        data["Target"] = np.where(data["Return"].shift(-1) > 0, 1, 0)

        data = data.dropna()

        features = ["MA10", "MA50", "Volatility"]
        X = data[features]
        y = data["Target"]

        # Split data
        X_train, X_test, y_train, y_test = train_test_split(
            X, y, test_size=0.2, shuffle=False
        )

        # Train model
        model = LogisticRegression()
        model.fit(X_train, y_train)

        # Accuracy
        y_pred = model.predict(X_test)
        acc = accuracy_score(y_test, y_pred)

        # Predict tomorrow
        latest_features = X.iloc[-1].values.reshape(1, -1)
        prediction = model.predict(latest_features)[0]
        prob = model.predict_proba(latest_features)[0][prediction]

        # Show results
        st.subheader("ðŸ“Š Model Accuracy:")
        st.write(f"{round(acc*100,2)}%")

        st.subheader("ðŸ”® Tomorrow's Prediction:")
        if prediction == 1:
            st.success(f"Stock likely to go UP ðŸ“ˆ (Confidence: {round(prob*100,2)}%)")
        else:
            st.error(f"Stock likely to go DOWN ðŸ“‰ (Confidence: {round(prob*100,2)}%)")

        # Plot chart
        st.subheader("ðŸ“‰ Stock Price Chart")
        fig, ax = plt.subplots()
        ax.plot(data["Close"])
        ax.set_title(f"{stock_symbol} Closing Price")
        st.pyplot(fig)